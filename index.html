<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Bluetooth LED Controller</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<h1>ESP32-C3 Bluetooth Controller</h1>

<button id="connectBtn">CONNECT</button>

<div id="controlPanel" style="display:none;">
    <button class="btn on" onclick="sendCommand('LED_ON')">LED ON</button>
    <button class="btn off" onclick="sendCommand('LED_OFF')">LED OFF</button>
</div>

<script>
let device;
let rxCharacteristic;

const SERVICE_UUID = "6E400001-B5A3-F393-E0A9-E50E24DCCA9E";
const RX_UUID      = "6E400002-B5A3-F393-E0A9-E50E24DCCA9E";

async function connectBluetooth() {
    try {
        device = await navigator.bluetooth.requestDevice({
            filters: [{ services: [SERVICE_UUID] }]
        });

        device.addEventListener('gattserverdisconnected', () => {
            alert('Device disconnected!');
            document.getElementById("controlPanel").style.display = "none";
            document.getElementById("connectBtn").textContent = "CONNECT";
            document.getElementById("connectBtn").disabled = false;
        });

        const server = await device.gatt.connect();
        const service = await server.getPrimaryService(SERVICE_UUID);
        rxCharacteristic = await service.getCharacteristic(RX_UUID);

        document.getElementById("controlPanel").style.display = "block";
        document.getElementById("connectBtn").textContent = "CONNECTED";
        document.getElementById("connectBtn").disabled = true;
        alert("Connected!");
    }
    catch (error) {
        alert("Connection failed: " + error);
    }
}

async function sendCommand(cmd) {
    if (!rxCharacteristic) return;
    const encoder = new TextEncoder();
    try {
        await rxCharacteristic.writeValue(encoder.encode(cmd));
    } catch(e) {
        alert("Failed to send command: " + e);
    }
}

document.getElementById("connectBtn").addEventListener("click", connectBluetooth);
</script>

</body>
</html>
