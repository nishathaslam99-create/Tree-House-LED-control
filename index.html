<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BLE LED Controller</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<h2>BLE LED Controller</h2>

<button id="connectBtn">Connect</button>

<div id="controls" style="display:none;">
    <button class="ledBtn" data-value="1">Turn ON</button>
    <button class="ledBtn" data-value="0">Turn OFF</button>
</div>

<script>
let bleDevice;
let bleServer;
let writeChar;

const SERVICE_UUID       = "12345678-1234-1234-1234-1234567890ab";
const CHARACTERISTIC_UUID = "abcd1234-5678-90ab-cdef-1234567890ab";

document.getElementById("connectBtn").onclick = async () => {
    try {
        console.log("Requesting device...");
        bleDevice = await navigator.bluetooth.requestDevice({
            filters: [{ services: [SERVICE_UUID] }]
        });

        console.log("Connecting...");
        bleServer = await bleDevice.gatt.connect();

        const service = await bleServer.getPrimaryService(SERVICE_UUID);
        writeChar = await service.getCharacteristic(CHARACTERISTIC_UUID);

        document.getElementById("controls").style.display = "block";
        console.log("Connected!");
    } catch (e) {
        console.error(e);
    }
};

document.querySelectorAll(".ledBtn").forEach(btn => {
    btn.addEventListener("click", async () => {
        if (!writeChar) return;

        const value = parseInt(btn.dataset.value);
        console.log("Sending:", value);

        try {
            await writeChar.writeValue(Uint8Array.from([value]));
        } catch (e) {
            console.error("Write error:", e);
        }
    });
});
</script>

</body>
</html>
